# gemini-cli プロジェクト構造分析

## 1. 概要

このドキュメントは `gemini-cli` プロジェクトのディレクトリ構造と各ファイルの役割を分析し、まとめたものです。

`gemini-cli` は、GoogleのGeminiモデルを活用したコマンドラインAIワークフローツールです。コードベースのクエリや編集、マルチモーダル機能を利用したアプリ生成、定型業務の自動化などを実現します。

技術スタックとしては、TypeScriptを中心としたNode.jsプロジェクトであり、UIの構築にはReact（Ink）、テストにはVitest、ビルドにはesbuildが採用されています。

## 2. プロジェクト構成

本プロジェクトは、`packages/` ディレクトリ以下に主要なソースコードを配置するモノレポ構成（npm workspacesを利用）となっています。

### 2.1. トップレベルディレクトリ・ファイル

| ファイル/ディレクトリ | 説明 |
| :--- | :--- |
| `.git/` | Gitのバージョン管理用ディレクトリ。 |
| `.github/` | GitHub Actionsのワークフロー、Issueテンプレート、PRテンプレートなど、GitHub関連の設定ファイル。 |
| `.gcp/` | Google Cloud Platformへのデプロイや公開に関連する設定ファイル（Dockerfileなど）。 |
| `.vscode/` | VSCodeエディタ用の設定ファイル（デバッグ設定、タスク設定など）。 |
| `docs/` | プロジェクトの公式ドキュメント。アーキテクチャ、コマンドリファレンス、チュートリアルなどが含まれる。 |
| `eslint-rules/` | カスタムESLintルールを定義するディレクトリ。 |
| `integration-tests/` | 結合テスト用のコード。サンドボックス環境を含めた、より実践的なシナリオをテストする。 |
| `node_modules/` | プロジェクトの依存パッケージがインストールされるディレクトリ。 |
| `packages/` | **（最重要）** プロジェクトの主要なソースコードが格納されるワークスペース。 |
| `scripts/` | ビルド、テスト、リリースなど、開発ワークフローを自動化するためのスクリプト群。 |
| `package.json` | プロジェクトのメタデータ、依存関係、スクリプト（`npm run ...`）を定義する。 |
| `README.md` | プロジェクトの概要、クイックスタート、使用例などを記載したドキュメント。 |
| `tsconfig.json` | TypeScriptのコンパイラ設定。 |
| `esbuild.config.js` | esbuildによるバンドル設定。`packages/`内のソースを`bundle/`ディレクトリに出力する。 |
| `eslint.config.js` | ESLintのリンティングルール設定。 |
| `vitest.config.ts` | Vitestテストフレームワークの設定。 |

### 2.2. `packages/` ワークスペース

モノレポの中心となるディレクトリ。機能ごとにパッケージが分割されています。

| パッケージ | 説明 |
| :--- | :--- |
| `cli/` | CLIのユーザーインターフェースとメインロジックを担うパッケージ。 |
| `core/` | Gemini APIとの通信、ツールAPI、設定管理など、アプリケーションのコア機能を担うパッケージ。 |

#### `packages/cli` の詳細

| ファイル/ディレクトリ | 説明 |
| :--- | :--- |
| `src/gemini.tsx` | CLIのメインエントリーポイントであり、UIのレンダリングを行うReact (Ink)コンポーネント。 |
| `src/nonInteractiveCli.ts` | 非対話モードでのCLI処理ロジック。 |
| `src/config/` | 認証情報や設定の管理を行うコード。 |
| `src/ui/` | React (Ink) を使ったUIコンポーネント、フック、コンテキスト、テーマなどが含まれる。 |
| `src/utils/` | サンドボックスの管理やバージョン情報など、CLI固有のユーティリティ関数。 |
| `vitest.config.ts` | `cli`パッケージに特化したVitestの設定。 |

#### `packages/core` の詳細

| ファイル/ディレクトリ | 説明 |
| :--- | :--- |
| `src/index.ts` | `core`パッケージのメインエントリーポイント。外部に公開されるAPIをエクスポートする。 |
| `src/code_assist/` | Geminiモデルとの対話、コード補完、OAuth2認証などの機能。 |
| `src/services/` | 外部サービスとの連携を行うコード（具体的な内容は要確認）。 |
| `src/telemetry/` | 利用状況の統計情報を収集・送信するためのコード。 |
| `src/tools/` | ファイルシステム操作、Web検索など、Geminiが利用するツールの実装。 |
| `src/utils/` | `core`パッケージ内で共通して使われるユーティリティ関数。 |
| `vitest.config.ts` | `core`パッケージに特化したVitestの設定。 |

## 3. ビルドと実行フロー

1.  **開発・コーディング**: 開発者は `packages/` 内のTypeScript (`.ts`, `.tsx`) ファイルを編集する。
2.  **ビルド**: `npm run build` を実行すると、`esbuild.config.js` の設定に基づき、`packages/` 内のソースコードがコンパイル・バンドルされ、単一の実行可能ファイル `bundle/gemini.js` が生成される。
3.  **実行**:
    *   `npm start` や `npx ...` コマンドで `bundle/gemini.js` がNode.js環境で実行される。
    *   `packages/cli/src/gemini.tsx` が呼び出され、ユーザーとの対話インターフェースがターミナルに表示される。
    *   ユーザーの入力に応じて、`packages/core` の機能（Gemini API連携、ツール実行など）が呼び出される。

## 4. テスト戦略

*   **単体・コンポーネントテスト**: `packages/`内の各ソースファイルに対応する `*.test.ts` や `*.test.tsx` ファイルに、Vitestを用いたテストが記述されている。これらは `npm run test` で実行される。
*   **結合テスト**: `integration-tests/` ディレクトリに、CLI全体の動作を確認するテストが配置されている。これらは実際のファイルシステムやサンドボックス環境と連携して動作し、より包括的な品質保証を担う。

## 5. まとめ

`gemini-cli`は、`core`（コア機能）と`cli`（UI）が明確に分離された、堅牢なモノレポ構成を採用している。TypeScriptによる静的型付け、esbuildによる高速なビルド、Vitestによるテスト、GitHub ActionsによるCI/CDなど、モダンな開発手法が取り入れられており、メンテナンス性と拡張性の高いプロジェクトであると言える。
